<div class="container">
  <div *ngIf="!orderConfirmation; else orderConfirmationTemplate">
    <mat-horizontal-stepper [linear]="isLinear">
      <mat-step [stepControl]="contactForm">
        <form [formGroup]="contactForm">
          <ng-template matStepLabel>Contact</ng-template>
          <div class="section-content">
            <div class="form-fields">
              <!-- Contact form fields -->
              <mat-form-field appearance="fill">
                <mat-label>First Name</mat-label>
                <input matInput formControlName="firstName" required>
                <mat-error *ngIf="contactForm.controls['firstName'].hasError('required')">First Name is required</mat-error>
                <mat-error *ngIf="contactForm.controls['firstName'].hasError('minlength')">First Name must be at least 2 characters</mat-error>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>Last Name</mat-label>
                <input matInput formControlName="lastName" required>
                <mat-error *ngIf="contactForm.controls['lastName'].hasError('required')">Last Name is required</mat-error>
                <mat-error *ngIf="contactForm.controls['lastName'].hasError('minlength')">Last Name must be at least 2 characters</mat-error>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>Phone Number</mat-label>
                <input matInput formControlName="phoneNumber" required>
                <mat-error *ngIf="contactForm.controls['phoneNumber'].hasError('required')">Phone Number is required</mat-error>
                <mat-error *ngIf="contactForm.controls['phoneNumber'].hasError('minlength')">Phone Number must be a 10-digit number</mat-error>
                <mat-error *ngIf="contactForm.controls['phoneNumber'].hasError('maxlength')">Phone Number must be a 10-digit number</mat-error>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>Email Address</mat-label>
                <input matInput formControlName="emailAddress" type="email" placeholder="example@email.com" required> 
                <mat-error *ngIf="contactForm.controls['emailAddress'].hasError('required')">Email Address is required</mat-error>
                <mat-error *ngIf="contactForm.controls['emailAddress'].hasError('email')">Email Address must be valid</mat-error>
              </mat-form-field>
            </div>
            <div class="button-container">
              <button mat-button matStepperNext type="button">Next</button>
            </div>
          </div>
        </form>
      </mat-step>
      <mat-step [stepControl]="shippingAddressForm">
        <form [formGroup]="shippingAddressForm">
          <ng-template matStepLabel>Shipping</ng-template>
          <div class="section-content">
            <div class="form-fields">
              <!-- Shipping address form fields -->
              <mat-form-field appearance="fill">
                <mat-label>Country</mat-label>
                <input matInput formControlName="country" required>
                <mat-error *ngIf="shippingAddressForm.controls['country'].hasError('required')">Country is required</mat-error>
                <mat-error *ngIf="shippingAddressForm.controls['country'].hasError('minlength')">Country must be at least 2 characters</mat-error>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>State</mat-label>
                <input matInput formControlName="state" required>
                <mat-error *ngIf="shippingAddressForm.controls['state'].hasError('required')">State is required</mat-error>
                <mat-error *ngIf="shippingAddressForm.controls['state'].hasError('minlength')">State must be at least 2 characters</mat-error>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>City</mat-label>
                <input matInput formControlName="city" required>
                <mat-error *ngIf="shippingAddressForm.controls['city'].hasError('required')">City is required</mat-error>
                <mat-error *ngIf="shippingAddressForm.controls['city'].hasError('minlength')">City must be at least 2 characters</mat-error>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>Zip Code</mat-label>
                <input matInput formControlName="zipCode" required>
                <mat-error *ngIf="shippingAddressForm.controls['zipCode'].hasError('required')">Zip Code is required</mat-error>
                <mat-error *ngIf="shippingAddressForm.controls['zipCode'].hasError('minlength')">Zip Code must be 5 characters</mat-error>
                <mat-error *ngIf="shippingAddressForm.controls['zipCode'].hasError('maxlength')">Zip Code must be 5 characters</mat-error>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>Address Line 1</mat-label>
                <input matInput formControlName="addressLine1" required>
                <mat-error *ngIf="shippingAddressForm.controls['addressLine1'].hasError('required')">Address Line 1 is required</mat-error>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>Address Line 2</mat-label>
                <input matInput formControlName="addressLine2" placeholder="Optional">
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>Apartment Number</mat-label>
                <input matInput formControlName="apartmentNumber" type="number" placeholder="Optional">
              </mat-form-field>
            </div>
            <div class="button-container">
              <button mat-button matStepperPrevious type="button">Back</button>
              <button mat-button matStepperNext type="button">Next</button>
            </div>
          </div>
        </form>
      </mat-step>
      <mat-step [stepControl]="paymentForm">
        <form [formGroup]="paymentForm">
          <ng-template matStepLabel>Payment</ng-template>
          <div class="section-content">
            <div class="form-fields">
              <!-- Payment form fields -->
              <mat-form-field appearance="fill">
                <mat-label>Credit Card Number</mat-label>
                <input matInput formControlName="creditCardNumber" required>
                <mat-error *ngIf="paymentForm.controls['creditCardNumber'].hasError('required')">Credit Card Number is required</mat-error>
                <mat-error *ngIf="paymentForm.controls['creditCardNumber'].hasError('minlength')">Credit Card Number must be 16 digits</mat-error>
                <mat-error *ngIf="paymentForm.controls['creditCardNumber'].hasError('maxlength')">Credit Card Number must be 16 digits</mat-error>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>Name on Card</mat-label>
                <input matInput formControlName="nameOnCard" required>
                <mat-error *ngIf="paymentForm.controls['nameOnCard'].hasError('required')">Name on Card is required</mat-error>
                <mat-error *ngIf="paymentForm.controls['nameOnCard'].hasError('minlength')">Name on Card must be at least 2 characters</mat-error>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>Expiration Date</mat-label>
                <input matInput formControlName="expiration" placeholder="MM/YY" required>
                <mat-error *ngIf="paymentForm.controls['expiration'].hasError('required')">Expiration Date is required</mat-error>
                <mat-error *ngIf="paymentForm.controls['expiration'].hasError('minlength')">Expiration Date must be 5 characters</mat-error>
                <mat-error *ngIf="paymentForm.controls['expiration'].hasError('maxlength')">Expiration Date must be 5 characters</mat-error>
              </mat-form-field>
              <mat-form-field appearance="fill">
                <mat-label>CVV Code</mat-label>
                <input matInput formControlName="cvvCode" required>
                <mat-error *ngIf="paymentForm.controls['cvvCode'].hasError('required')">CVV Code is required</mat-error>
                <mat-error *ngIf="paymentForm.controls['cvvCode'].hasError('minlength')">CVV Code must be 3 characters</mat-error>
                <mat-error *ngIf="paymentForm.controls['cvvCode'].hasError('maxlength')">CVV Code must be 3 characters</mat-error>
              </mat-form-field>
            </div>
            <div class="button-container">
              <button mat-button matStepperPrevious type="button">Back</button>
              <button mat-button matStepperNext type="button">Next</button>
            </div>
          </div>
        </form>
      </mat-step>
      <mat-step>
        <ng-template matStepLabel>Review</ng-template>
        <div class="section-content">
          <div class="review-section" *ngIf="contactForm.valid && shippingAddressForm.valid && paymentForm.valid">
            <!-- Review content -->
            <h2>Contact Information</h2>
            <p>Name: {{ contactForm.value.firstName }} {{ contactForm.value.lastName }}</p>
            <p>Phone Number: {{ contactForm.value.phoneNumber }}</p>
            <p>Email Address: {{ contactForm.value.emailAddress }}</p>
      
            <h2>Shipping Address</h2>
            <p>{{ shippingAddressForm.value.addressLine1 }} {{ shippingAddressForm.value.addressLine2 ? shippingAddressForm.value.addressLine2 + ',' : '' }}</p>
            <p>{{ shippingAddressForm.value.apartmentNumber ? shippingAddressForm.value.apartmentNumber + ',' : '' }} {{ shippingAddressForm.value.city }}, {{ shippingAddressForm.value.state }}, {{ shippingAddressForm.value.zipCode }}</p>
            <p>{{ shippingAddressForm.value.country }}</p>
      
            <h2>Payment Information</h2>
            <p>Card Number: **** **** **** {{ paymentForm.value.creditCardNumber.substr(-4) }}</p>
            <p>Name on Card: {{ paymentForm.value.nameOnCard }}</p>
            <p>Expiration Date: {{ paymentForm.value.expiration }}</p>
      
            <h2>Order Summary</h2>
            <div *ngIf="cartDetails">
              <div *ngFor="let entry of cartDetails.cartEntries">
                <p>{{ entry.name }} x{{ entry.quantity }}: {{ entry.price * entry.quantity | currency }}</p>
              </div>        
              <hr>
              <div class="summary-item">
                <span>Subtotal</span>
                <span>{{ cartDetails.subtotal | currency }}</span>
              </div>
              <div class="summary-item">
                <span>Tax</span>
                <span>{{ cartDetails.tax | currency }}</span>
              </div>
              <div class="summary-item">
                <span>Shipping</span>
                <span>{{ cartDetails.shipping | currency }}</span>
              </div>
              <hr>
              <div class="summary-item total">
                <span>Total</span>
                <span>{{ cartDetails.totalPrice | currency }}</span>
              </div>
            </div>
          </div>
          <div class="button-container">
            <button mat-button matStepperPrevious type="button">Back</button>
            <button mat-raised-button color="primary" (click)="onSubmit()" type="button">Place Order</button>
            <div *ngIf="orderErrorMessage" class="error-message">
              {{ orderErrorMessage }}
            </div>
          </div>
        </div>
      </mat-step>
    </mat-horizontal-stepper>
  </div>
  <ng-template #orderConfirmationTemplate>
    <div class="confirmation-message">
      <h2>Order Confirmation</h2>
      <p>
        Your order has been conjured! Your order number is <b>{{ orderConfirmation?.orderNumber }}</b>.
        Keep an eye on your arcane inbox for more information.
      </p>
      <p>Venture forth and discover more enchanting items in our wondrous collection.</p>
      <button mat-raised-button color="primary" routerLink="/catalog" type="button">Back to Catalog</button>
    </div>
  </ng-template>  
</div>